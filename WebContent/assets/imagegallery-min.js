(function(d){d.fn.adGallery=function(g){var f=d(".context_path",this).html();var i={istablet:false,context_path:f,loader_image:f+"assets/loader.gif",start_at_index:0,description_wrapper:false,thumb_opacity:0.5,animate_first_image:false,animation_speed:400,width:540,height:320,thumb_height:46,thumb_width:78,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:4000,stop_on_scroll:true,countdown_prefix:"(",countdown_sufix:")"},effect:"slide-hori",cycle:true,hooks:{displayDescription:false},callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var h=d.extend(false,i,g);if(g&&g.slideshow){h.slideshow=d.extend(false,i.slideshow,g.slideshow)}if(!h.slideshow.enable){h.slideshow.autostart=false}var e=new c(this,h);return e};function c(f,e){this.init(f,e)}c.prototype={wrapper:false,image_wrapper:false,nav:false,loader:false,thumbs_wrapper:false,thumbs_wrapper_width:0,scroll_back:false,scroll_forward:false,next_link:false,play_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:-1,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(i,h){var g=this;this.wrapper=d(i);this.settings=h;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else{this.image_wrapper_width=this.image_wrapper.width()}if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else{this.image_wrapper_height=this.image_wrapper.height()}this.nav_display_width=this.nav.width();this.current_index=-1;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev()}var e=function(j){return g.nextImage(j)};this.slideshow=new a(e,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable()}else{this.slideshow.disable()}if(this.settings.display_back_and_forward){this.initBackAndForward()}var f=parseInt(this.settings.start_at_index,10);if(typeof this.getIndexFromHash()!="undefined"){f=this.getIndexFromHash()}this.loading(true);this.showImage(f,function(){if(g.settings.slideshow.autostart){g.preloadImage(f+1);g.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.image_wrapper=this.wrapper.find(".ad-image-wrapper");this.image_wrapper.empty();this.nav=this.wrapper.find(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.loader=d('<img class="ad-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide()},setupAnimations:function(){this.animations={"slide-hori":b}},findImages:function(){var i=this;this.images=[];var h=0;var g=this.thumbs_wrapper.find("a");var f=g.length;if(this.settings.thumb_opacity<1){g.find("img").css("opacity",this.settings.thumb_opacity)}g.each(function(k){var m=d(this);m.data("ad-i",k);var l=m.attr("href");var j=m.find("img");i.whenImageLoaded(j[0],function(){var p=j[0].parentNode.parentNode.offsetWidth;if(j[0].width==0){p=100}var o=i.settings.thumb_width/i.settings.thumb_height;var n=j[0].width/j[0].height;if(n<o){j[0].height=i.settings.thumb_height;j[0].width=i.settings.thumb_height*n}if(n>o){j[0].width=i.settings.thumb_width;j[0].height=i.settings.thumb_width/n}if(j[0].width==i.settings.thumb_width){var q=i.settings.thumb_height-j[0].height;j[0].style.marginTop=q/2+"px"}i.thumbs_wrapper_width+=p;h++});i._initLink(m);i.images[k]=i._createImageData(m,l)});var e=setInterval(function(){if(f==h){i._setThumbListWidth(i.thumbs_wrapper_width);clearInterval(e)}},100)},whenImageLoaded:function(e,f){if(this.isImageLoaded(e)){f&&f()}else{d(e).load(f)}},isImageLoaded:function(e){if(typeof e.complete!="undefined"&&!e.complete){return false}if(typeof e.naturalWidth!="undefined"&&e.naturalWidth==0){return false}return true},_initLink:function(f){var e=this;f.click(function(){e.showImage(f.data("ad-i"));e.slideshow.stop();return false}).hover(function(){if(!d(this).is(".ad-active")&&e.settings.thumb_opacity<1){d(this).find("img").fadeTo(300,1)}e.preloadImage(f.data("ad-i"))},function(){if(!d(this).is(".ad-active")&&e.settings.thumb_opacity<1){d(this).find("img").fadeTo(300,e.settings.thumb_opacity)}})},showImage:function(e,h){if(this.images[e]&&!this.in_transition&&e!=this.current_index){var f=this;var g=this.images[e];this.in_transition=true;if(!g.preloaded){this.loading(true);this.preloadImage(e,function(){f.loading(false);f._showWhenLoaded(e,h)})}else{this._showWhenLoaded(e,h)}}},loading:function(e){if(e){this.loader.show()}else{this.loader.hide()}},preloadImage:function(f,i){if(this.images[f]){var h=this.images[f];if(!this.images[f].preloaded){var e=d(new Image());e.attr("src",h.image);if(!this.isImageLoaded(e[0])){var g=this;e.load(function(){h.preloaded=true;h.size={width:this.width,height:this.height};g.fireCallback(i)}).error(function(){h.error=true;h.preloaded=false;h.size=false})}else{h.preloaded=true;h.size={width:e[0].width,height:e[0].height};this.fireCallback(i)}}else{this.fireCallback(i)}}},fireCallback:function(e){if(d.isFunction(e)){e.call(this)}},whenImageLoaded:function(e,f){if(this.isImageLoaded(e)){f&&f()}else{d(e).load(f)}},_createImageData:function(j,f){var g=false;var e=j.find("img");if(e.data("ad-link")){g=j.data("ad-link")}else{if(e.attr("longdesc")&&e.attr("longdesc").length){g=e.attr("longdesc")}}var i=false;if(e.data("ad-desc")){i=e.data("ad-desc")}else{if(e.attr("alt")&&e.attr("alt").length){i=e.attr("alt")}}var h=false;if(e.data("ad-title")){h=e.data("ad-title")}else{if(e.attr("title")&&e.attr("title").length){h=e.attr("title")}}return{thumb_link:j,image:f,error:false,preloaded:false,desc:i,title:h,size:false,link:g}},_setThumbListWidth:function(e){e-=100;var h=this.nav.find(".ad-thumb-list");h.css("width",e+"px");var g=1;var f=h.height();while(g<201){h.css("width",(e+g)+"px");if(f!=h.height()){break}f=h.height();g++}if(h.width()<this.nav.width()){h.width(this.nav.width())}},addAnimation:function(e,f){if(d.isFunction(f)){this.animations[e]=f}},getIndexFromHash:function(){if(window.location.hash&&window.location.hash.indexOf("#ad-image-")===0){var f=window.location.hash.replace(/^#ad-image-/g,"");var e=this.thumbs_wrapper.find("#"+f);if(e.length){return this.thumbs_wrapper.find("a").index(e)}else{if(!isNaN(parseInt(f,10))){return parseInt(f,10)}}}return undefined},initNextAndPrev:function(){this.next_link=d('<div class="ad-next"><div class="ad-next-image"></div></div>');this.play_link=d('<div class="ad-play"><div class="ad-play-image"></div></div>');this.prev_link=d('<div class="ad-prev"><div class="ad-prev-image"></div></div>');this.image_wrapper.append(this.prev_link);this.image_wrapper.append(this.play_link);this.image_wrapper.append(this.next_link);var e=this;this.prev_link.add(this.next_link).add(this.play_link).mouseover(function(g){if(d(this).is(".ad-play")){var f=d(this).find("div")[0];if(e.slideshow.running){d(f).css("background-image","url("+e.settings.context_path+"/etc/design/imindef_style/imindef2012/images/imagegallery/vid_pause.png)")}else{d(f).css("background-image","url("+e.settings.context_path+"/etc/design/imindef_style/imindef2012/images/imagegallery/vid_play.png)")}}d(this).find("div").show()}).mouseout(function(f){d(this).find("div").hide()}).click(function(){if(d(this).is(".ad-next")){e.nextImage();e.slideshow.stop()}if(d(this).is(".ad-play")){var f=d(this).find("div")[0];if(!e.slideshow.running){e.slideshow.start();d(f).css("background-image","url("+e.settings.context_path+"/etc/design/imindef_style/imindef2012/images/imagegallery/vid_pause.png)")}else{e.slideshow.stop();d(f).css("background-image","url("+e.settings.context_path+"/etc/design/imindef_style/imindef2012/images/imagegallery/vid_play.png)")}}else{e.prevImage();e.slideshow.stop()}})},initBackAndForward:function(){var g=this;this.scroll_forward=d('<div class="ad-forward"></div>');this.scroll_back=d('<div class="ad-back"></div>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var f=0;var e=false;d(this.scroll_back).add(this.scroll_forward).click(function(){var h=g.nav_display_width-50;if(g.settings.scroll_jump>0){var h=g.settings.scroll_jump}if(d(this).is(".ad-forward")){var i=g.thumbs_wrapper.scrollLeft()+h}else{var i=g.thumbs_wrapper.scrollLeft()-h}if(g.settings.slideshow.stop_on_scroll){g.slideshow.stop()}g.thumbs_wrapper.animate({scrollLeft:i+"px"});return false}).css("opacity",0.6).hover(function(){var h="left";if(d(this).is(".ad-forward")){h="right"}e=setInterval(function(){f++;if(f>30&&g.settings.slideshow.stop_on_scroll){g.slideshow.stop()}var i=g.thumbs_wrapper.scrollLeft()+1;if(h=="left"){i=g.thumbs_wrapper.scrollLeft()-1}g.thumbs_wrapper.scrollLeft(i)},10);d(this).css("opacity",1)},function(){f=0;clearInterval(e);d(this).css("opacity",0.6)})},_afterShow:function(){this.controls.html((this.current_index+1)+" / "+this.images.length);if(!this.settings.cycle){this.prev_link.show().css("height",this.image_wrapper_height);this.next_link.show().css("height",this.image_wrapper_height);if(this.current_index==(this.images.length-1)){this.next_link.hide()}if(this.current_index==0){this.prev_link.hide()}}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(f,e){if(e>this.image_wrapper_height){var g=f/e;e=this.image_wrapper_height;f=this.image_wrapper_height*g}if(f>this.image_wrapper_width){var g=e/f;f=this.image_wrapper_width;e=this.image_wrapper_width*g}return{width:f,height:e}},_centerImage:function(h,f,e){h.css("top","0px");if(e<this.image_wrapper_height){var g=this.image_wrapper_height-e;h.css("top",(g/2)+"px")}h.css("left","0px");if(f<this.image_wrapper_width){var g=this.image_wrapper_width-f;h.css("left",(g/2)+"px")}},_getDescription:function(g){var e=false;var f=false;if(g.desc.length){var h="";if(g.desc.length){h=g.desc}e=d('<div class="ad-image-description">'+h+"</div>");f={text:h,html:e}}return f},_showWhenLoaded:function(l,j){if(this.images[l]){var h=this;var q=this.images[l];var n=d(document.createElement("div")).addClass("ad-image");var x=d(new Image()).attr("src",q.image);if(q.link){var m=d('<a href="'+q.link+'" target="_blank"></a>');m.append(x);n.append(m)}else{n.append(x)}this.image_wrapper.prepend(n);var p=this._getContainedImageSize(q.size.width,q.size.height);x.attr("width",p.width);x.attr("height",p.height);n.css({width:p.width+"px",height:p.height+"px"});this._centerImage(n,p.width,p.height);var r=this._getDescription(q);var u=false;if(r){u=r.html}if(u){if(!this.settings.description_wrapper&&!this.settings.hooks.displayDescription){this.image_wrapper.append(u);var t=this.settings.width-parseInt(u.css("padding-left"),10)-parseInt(u.css("padding-right"),10);u.css("width",t+"px")}else{if(this.settings.hooks.displayDescription){this.settings.hooks.displayDescription.call(this,q)}else{var k=this.settings.description_wrapper;k.append(u)}}}var i=d("<a href='' class='button_pic_increase2 fancybox'></a>");if(r){d(i).attr("atitle",r.text)}d(i).removeAttr("href");this.image_wrapper.append(i);var x=d(".ad-image",this.image_wrapper).find("img")[0];var g=d(x).attr("src");d(i).fancybox({istablet:this.settings.istablet},g);this.highLightThumb(this.images[l].thumb_link);var w="right";if(this.current_index<l){w="left"}this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var f=this.settings.animation_speed;var s="swing";var v=this.animations[this.settings.effect].call(this,n,w,u);if(typeof v.speed!="undefined"){f=v.speed}if(typeof v.easing!="undefined"){s=v.easing}if(this.current_image){var e=this.current_image;var o=this.current_description;e.animate(v.old_image,f,s,function(){e.remove();if(o){o.remove()}})}n.animate(v.new_image,f,s,function(){h.current_index=l;h.current_image=n;h.current_description=u;h.in_transition=false;h._afterShow();h.fireCallback(j)})}else{this.current_index=l;this.current_image=n;h.current_description=u;this.in_transition=false;h._afterShow();this.fireCallback(j)}}},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle){return false}var e=0}else{var e=this.current_index+1}return e},nextImage:function(f){var e=this.nextIndex();if(e===false){return false}this.preloadImage(e+1);this.showImage(e,f);return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false}var e=this.images.length-1}else{var e=this.current_index-1}return e},prevImage:function(f){var e=this.prevIndex();if(e===false){return false}this.preloadImage(e-1);this.showImage(e,f);return true},preloadAll:function(){var f=this;var e=0;function g(){if(e<f.images.length){e++;f.preloadImage(e,g)}}f.preloadImage(e,g)},highLightThumb:function(e){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");e.addClass("ad-active");if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);e.find("img").fadeTo(300,1)}var f=e[0].parentNode.offsetLeft;f-=(this.nav_display_width/2)-(e[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:f+"px"})}};function b(f,g,i){var h=parseInt(f.css("left"),10);if(g=="left"){var e="-"+this.image_wrapper_width+"px";f.css("left",this.image_wrapper_width+"px")}else{var e=this.image_wrapper_width+"px";f.css("left","-"+this.image_wrapper_width+"px")}if(i){i.css("bottom","-"+i[0].offsetHeight+"px");i.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{left:e},new_image:{left:h}}}function a(e,f){this.init(e,f)}a.prototype={countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(e,g){var f=this;this.nextimage_callback=e;this.settings=g},create:function(){this.countdown=d('<span class="ad-slideshow-countdown"></span>');this.controls=d("");var e=this;d(document).keydown(function(f){if(f.keyCode==83){if(e.running){e.stop()}else{e.start()}}});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true;this.controls.show()},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},start:function(){if(this.running||!this.enabled){return false}var e=this;this.running=true;this.controls.addClass("ad-slideshow-running");this._next();return true},stop:function(){if(!this.running){return false}this.running=false;this.controls.removeClass("ad-slideshow-running");clearInterval(this.countdown_interval);return true},_next:function(){var g=this;var h=this.settings.countdown_prefix;var f=this.settings.countdown_sufix;clearInterval(g.countdown_interval);this.countdown.html(h+(this.settings.speed/1000)+f);var e=0;this.countdown_interval=setInterval(function(){e+=1000;if(e>=g.settings.speed){var j=function(){if(g.running){g._next()}e=0};if(!g.nextimage_callback(j)){g.stop()}e=0}var i=parseInt(g.countdown.text().replace(/[^0-9]/g,""),10);i--;if(i>0){g.countdown.html(h+i+f)}},1000)},fireCallback:function(e){if(d.isFunction(e)){e.call(this)}}}})(jQuery);